# ğŸ“š **Ø§Ù„Ø´Ø±Ø­ Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØ§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ù€ Implementation Ù…Ù† Ø§Ù„Ø£Ù„Ù Ù„Ù„ÙŠØ§Ø¡**

---

## ğŸ¯ **1. Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù…Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹**

### **Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:**
Ø¹Ù†Ø¯Ùƒ Ù…Ø§Ù„Ùƒ (Owner) Ø¨ÙŠØ³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…ØŒ ÙˆØ¹Ø§ÙŠØ² ÙŠØ®ØªØ§Ø± Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ø§Ù„Ù„ÙŠ Ù‡ÙŠØ´ØªØºÙ„ Ø¹Ù„ÙŠÙ‡Ø§.
Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø­ØªØ§Ø¬ ÙŠÙ‚ØªØ±Ø­ Ù„Ù‡ Ù…Ù†Ø´Ø¢Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ **Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (AI)**.

### **Ø§Ù„Ø­Ù„:**
Ø¥Ù†Ø´Ø§Ø¡ **API** Ø¬Ø¯ÙŠØ¯ ÙŠØ³ØªØ¯Ø¹ÙŠ Ø®Ø¯Ù…Ø© Ø§Ù„Ù€ AI ÙˆÙŠØ±Ø¬Ø¹ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø°ÙƒÙŠØ© Ù„Ù„Ù…Ù†Ø´Ø¢Øª.

---

## ğŸ§© **2. Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…**

Ù‚Ø¨Ù„ Ù…Ø§ Ù†Ø¨Ø¯Ø£ØŒ Ø®Ù„ÙŠÙ†ÙŠ Ø£Ø´Ø±Ø­Ù„Ùƒ ÙƒÙ„ Ù…ÙƒÙˆÙ‘Ù† ÙÙŠ Ø§Ù„Ù€ Architecture:

### **Ø£. UI (User Interface) - Angular**
- Ø¯Ù‡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨ÙŠØ´ÙˆÙÙ‡Ø§ (Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£Ùˆ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚).
- Ø¨ÙŠØ¨Ø¹Øª **HTTP Request** Ù„Ù„Ù€ backend Ø¹Ø´Ø§Ù† ÙŠØ¬ÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.

---

### **Ø¨. Apigee (API Gateway)**
**ÙŠØ¹Ù†ÙŠ Ø¥ÙŠÙ‡ API GatewayØŸ**
- ØªØ®ÙŠÙ„Ù‡ **Ø­Ø§Ø±Ø³ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©** Ø£Ùˆ **Ø§Ù„Ø±ÙŠØ³ÙŠØ¨Ø´Ù†** ÙÙŠ Ø´Ø±ÙƒØ©.
- Ø£ÙŠ Ø·Ù„Ø¨ (request) Ø¬Ø§ÙŠ Ù…Ù† UI Ù„Ø§Ø²Ù… ÙŠØ¹Ø¯Ù‘ÙŠ Ø¹Ù„Ù‰ Apigee Ø§Ù„Ø£ÙˆÙ„.

**ÙˆØ¸ÙŠÙØªÙ‡:**
1. **Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ© (Authentication):**
   - ÙŠØ´ÙŠÙƒ Ø¥Ù† Ø§Ù„Ù€ request ÙÙŠÙ‡ API Key ØµØ­ÙŠØ­.
   - Ø²ÙŠ Ù…Ø§ Ø§Ù„Ø­Ø§Ø±Ø³ ÙŠØªØ£ÙƒØ¯ Ø¥Ù† Ù…Ø¹Ø§Ùƒ Ø¨Ø·Ø§Ù‚Ø© Ø¯Ø®ÙˆÙ„.

2. **Ø§Ù„Ø£Ù…Ø§Ù† (Security):**
   - Ø¨ÙŠØ·Ø¨Ù‘Ù‚ Ø³ÙŠØ§Ø³Ø§Øª Ø£Ù…Ø§Ù† (Ù…Ø«Ù„Ø§Ù‹: AmeenSecurityCheck).
   - Ø¨ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø© Ø£Ùˆ Ø§Ù„Ø¶Ø§Ø±Ø©.

3. **Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ (Routing):**
   - Ø¨ÙŠÙˆØ¬Ù‘Ù‡ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØµØ­ÙŠØ­ (BackendØŒ OSBØŒ Ø¥Ù„Ø®).

4. **Rate Limiting:**
   - Ø¨ÙŠØ­Ø¯Ø¯ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù„ÙŠ Ù…Ù…ÙƒÙ† ØªØªØ¨Ø¹Øª ÙÙŠ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©/Ø§Ù„Ø³Ø§Ø¹Ø©.
   - ÙŠÙ…Ù†Ø¹ Ø§Ù„Ù€ DDoS attacks.

---

### **Ø¬. OWS Backend (Owner Sphere Backend) - Java/Spring Boot**
**Ø¯Ù‡ Ø§Ù„Ù‚Ù„Ø¨ Ø§Ù„Ù†Ø§Ø¨Ø¶ Ù„Ù„Ù†Ø¸Ø§Ù….**

**ÙˆØ¸ÙŠÙØªÙ‡:**
- Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† Apigee.
- ØªÙ†ÙÙŠØ° **Business Logic** (Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ).
- Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.
- Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø®Ø¯Ù…Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ© (Ø²ÙŠ OSB Ø£Ùˆ AI).
- Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©.

**Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:**
- **Spring Boot** - Framework Ù„Ù„Ù€ Java
- **RestTemplate** - Ù„Ù„Ù€ HTTP Calls
- **JPA/Hibernate** - Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Database
- **Lombok** - Ù„ØªØ¨Ø³ÙŠØ· Ø§Ù„ÙƒÙˆØ¯

---

### **Ø¯. OSB (Oracle Service Bus)**
**ÙŠØ¹Ù†ÙŠ Ø¥ÙŠÙ‡ Service BusØŸ**
- ØªØ®ÙŠÙ„Ù‡ **Ù…Ø­Ø·Ø© Ø§Ù„Ø¨Ø§Øµ** Ø§Ù„Ù„ÙŠ Ø¨ØªÙˆØµÙ„ Ø¨ÙŠÙ† Ø£Ù…Ø§ÙƒÙ† Ù…Ø®ØªÙ„ÙØ©.
- Ø£Ùˆ **Ù…ØªØ±Ø¬Ù…** Ø¨ÙŠÙ† Ù†Ø¸Ø§Ù…ÙŠÙ† Ù…Ø§ Ø¨ÙŠØªÙƒÙ„Ù…ÙˆØ´ Ù†ÙØ³ Ø§Ù„Ù„ØºØ©.

**ÙˆØ¸ÙŠÙØªÙ‡:**
- **Middleware** (ÙˆØ³ÙŠØ·) Ø¨ÙŠÙ† Ø§Ù„Ù€ Backend ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©.
- Ø¨ÙŠØ­ÙˆÙ‘Ù„ ØµÙŠØºØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Transformation).
- Ø¨ÙŠÙˆØ¬Ù‘Ù‡ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„Ø£ÙƒØ«Ø± Ù…Ù† Ø¬Ù‡Ø© (Routing).
- Ø¨ÙŠØ¹Ù…Ù„ Logging Ùˆ Monitoring.

**Ù„ÙŠÙ‡ Ù…Ø­ØªØ§Ø¬ÙŠÙ† OSBØŸ**
- Ø¹Ù„Ø´Ø§Ù† Ù†ÙØµÙ„ Ø§Ù„Ù€ Backend Ø¹Ù† Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©.
- Ù„Ùˆ Ø§Ù„Ù€ AI service Ø§ØªØºÙŠØ± Ù…ÙƒØ§Ù†Ù‡ Ø£Ùˆ Ø·Ø±ÙŠÙ‚ØªÙ‡ØŒ Ù†Ø¹Ø¯Ù‘Ù„ OSB Ø¨Ø³.
- Ø§Ù„Ù€ Backend Ù…Ø§ ÙŠØªØ£Ø«Ø±Ø´.

---

### **Ù‡Ù€. AI Service (Ø®Ø¯Ù…Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ)**
**Ø¯Ù‡ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù„ÙŠ Ø¨ÙŠØ´ØªØºÙ„ Ø¹Ù„ÙŠÙ‡ ÙØ±ÙŠÙ‚ Ø§Ù„Ù€ AI.**

**ÙˆØ¸ÙŠÙØªÙ‡:**
- Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø´Ø£Ø© (Registration Number).
- ØªØ­Ù„ÙŠÙ„Ù‡Ø§ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… **Machine Learning Models**.
- Ø¥Ø±Ø¬Ø§Ø¹ Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ù…Ø¹ Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ·Ø§Ø¨Ù‚.

**Ù…Ø«Ø§Ù„:**
```json
Request: { "regNo": 501234567 }

Response: {
  "suggestions": [
    {
      "establishmentId": 501999888,
      "establishmentName": "Ø´Ø±ÙƒØ© Ø§Ù„Ù†Ø¬Ø§Ø­ Ù„Ù„ØªØ¬Ø§Ø±Ø©",
      "matchScore": 0.92,
      "reason": "Similar industry"
    }
  ]
}
```

---

## ğŸ”„ **3. Ø§Ù„Ù€ Flow Ø§Ù„ÙƒØ§Ù…Ù„ (Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù„Ù„Ù†Ù‡Ø§ÙŠØ©)**

### **Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ:**
Ù…Ø§Ù„Ùƒ Ø§Ø³Ù…Ù‡ "Ø£Ø­Ù…Ø¯" Ø¯Ø®Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…ØŒ ÙˆØ¹Ø§ÙŠØ² ÙŠØ®ØªØ§Ø± Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ø§Ù„Ù„ÙŠ Ù‡ÙŠØ´ØªØºÙ„ Ø¹Ù„ÙŠÙ‡Ø§.

---

### **Ø§Ù„Ø®Ø·ÙˆØ© 1: UI ØªØ¨Ø¹Øª Request**
```http
GET https://ameenfea12.apigee.net/v1/owner-sphere/b2b/501234567/suggestions
Headers:
  apikey: AbLvRAQpDbkKi9haiVOzydAGShiDhpGC
```

**Ø´Ø±Ø­:**
- Ø§Ù„Ù€ URL ÙÙŠÙ‡Ø§ Ø±Ù‚Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø©: `501234567`
- Ø§Ù„Ù€ `apikey` Ø¯Ù‡ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡ÙˆÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.

---

### **Ø§Ù„Ø®Ø·ÙˆØ© 2: Apigee Proxy #1 ÙŠØ³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø·Ù„Ø¨**

**Ø§Ù„Ù€ Proxy:** `OSP_EstablishmentServiceAPIProxy`
**Ø§Ù„Ù…Ø³Ø§Ø±:** `/v1/owner-sphere/b2b/{regNo}/suggestions`

**Ø§Ù„Ù„ÙŠ Ø¨ÙŠØ­ØµÙ„ Ø¬ÙˆÙ‡ Apigee:**
1. **PreFlow (Request):**
   ```xml
   <Step><Name>VerifyAPIKey</Name></Step>
   <Step><Name>AmeenSecurityCheck</Name></Step>
   ```
   - Ø¨ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù€ `apikey` ØµØ­ÙŠØ­ ÙˆÙ„Ø§ Ù„Ø£.
   - Ù„Ùˆ ØºÙ„Ø· â†’ ÙŠØ±Ø¬Ø¹ **401 Unauthorized**.
   - Ù„Ùˆ ØµØ­ â†’ ÙŠÙƒÙ…Ù„.

2. **Routing:**
   ```xml
   <TargetEndpoint>default</TargetEndpoint>
   ```
   - Ø¨ÙŠÙˆØ¬Ù‘Ù‡ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ù€ **OWS Backend**.

---

### **Ø§Ù„Ø®Ø·ÙˆØ© 3: OWS Backend ÙŠØ³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø·Ù„Ø¨**

#### **Ø£. Controller ÙŠØ³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø·Ù„Ø¨**

ğŸ“‚ `B2BSuggestionsController.java`

```java
@RestController
@RequestMapping("/owner-sphere/b2b")
public class B2BSuggestionsController {

    @Autowired
    private OsbAiProxy osbAiProxy;

    @GetMapping("/{regNo}/suggestions")
    public ResponseEntity<SuggestionsResponse> getSuggestions(@PathVariable Long regNo) {
        log.info("Received request for regNo: {}", regNo);
        
        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ù€ Proxy
        SuggestionsResponse response = osbAiProxy.fetchAiSuggestions(regNo);
        
        return ResponseEntity.ok(response);
    }
}
```

**Ø´Ø±Ø­ Ø§Ù„Ø³Ø·ÙˆØ±:**

| Ø§Ù„Ø³Ø·Ø± | Ø§Ù„Ø´Ø±Ø­ |
|-------|-------|
| `@RestController` | Ø¨ÙŠÙ‚ÙˆÙ„ Ù„Ù€ Spring Ø¥Ù† Ø¯Ù‡ Controller Ø¨ÙŠØ±Ø¯ JSON |
| `@RequestMapping("/owner-sphere/b2b")` | Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ |
| `@GetMapping("/{regNo}/suggestions")` | Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ÙØ±Ø¹ÙŠ + HTTP Method |
| `@PathVariable Long regNo` | Ø¨ÙŠØ§Ø®Ø¯ Ø§Ù„Ø±Ù‚Ù… Ù…Ù† Ø§Ù„Ù€ URL |
| `osbAiProxy.fetchAiSuggestions(regNo)` | Ø¨ÙŠÙ†Ø§Ø¯ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù€ Proxy Service |
| `ResponseEntity.ok(response)` | Ø¨ÙŠØ±Ø¬Ø¹ HTTP 200 Ù…Ø¹ Ø§Ù„Ù€ response |

---

#### **Ø¨. Proxy Service ÙŠÙƒÙ„Ù… Apigee**

ğŸ“‚ OsbAiProxy.java

```java
@Service
public class OsbAiProxy {

    @Value("${api.base.url}")
    private String apigeeBaseUrl;  // â† http://amnapigeedev.gosi.ins:9640

    @Value("${app.apikey}")
    private String apiKey;  // â† AbLvRAQpDbkKi9haiVOzydAGShiDhpGC

    private final RestTemplate restTemplate;

    public SuggestionsResponse fetchAiSuggestions(Long regNo) {
        String requestId = UUID.randomUUID().toString();
        log.info("[{}] Calling Apigee for regNo: {}", requestId, regNo);

        try {
            // 1ï¸âƒ£ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù€ URL
            String url = String.format(
                "%s/v1/osb/ai/suggestions?regNo=%d", 
                apigeeBaseUrl, 
                regNo
            );
            // Ø§Ù„Ù†ØªÙŠØ¬Ø©: http://amnapigeedev.gosi.ins:9640/v1/osb/ai/suggestions?regNo=501234567

            // 2ï¸âƒ£ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù€ Headers
            HttpHeaders headers = new HttpHeaders();
            headers.setContentType(MediaType.APPLICATION_JSON);
            headers.set("X-Request-Id", requestId);
            headers.set("apikey", apiKey);  // â† Ù„Ù„ØªØ­Ù‚Ù‚ ÙÙŠ Apigee

            HttpEntity<String> entity = new HttpEntity<>(headers);

            // 3ï¸âƒ£ HTTP GET Request
            ResponseEntity<SuggestionsResponse> response = restTemplate.exchange(
                url,
                HttpMethod.GET,
                entity,
                SuggestionsResponse.class
            );

            return response.getBody();

        } catch (HttpClientErrorException e) {
            // 4xx errors
            log.error("Client error: {}", e.getStatusCode());
            return buildErrorResponse(requestId, "CLIENT_ERROR", "Invalid request");

        } catch (HttpServerErrorException e) {
            // 5xx errors
            log.error("Server error: {}", e.getStatusCode());
            return buildErrorResponse(requestId, "AI_SERVER_ERROR", "AI service error");

        } catch (ResourceAccessException e) {
            // Timeout
            log.error("Timeout: {}", e.getMessage());
            return buildErrorResponse(requestId, "AI_UNAVAILABLE", "AI unavailable");

        } catch (Exception e) {
            log.error("Unexpected error: {}", e.getMessage());
            return buildErrorResponse(requestId, "ERROR", "Unexpected error");
        }
    }

    private SuggestionsResponse buildErrorResponse(String requestId, String status, String message) {
        SuggestionsResponse fallback = new SuggestionsResponse();
        fallback.setStatus(status);
        fallback.setMessage(message);
        fallback.setSuggestions(Collections.emptyList());
        fallback.setRequestId(requestId);
        fallback.setTimestamp(Instant.now().toEpochMilli());
        return fallback;
    }
}
```

**Ø´Ø±Ø­ Error Handling:**

| Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·Ø£ | Ù…ØªÙ‰ ÙŠØ­ØµÙ„ | Ø§Ù„Ø±Ø¯ |
|-----------|----------|------|
| `HttpClientErrorException` | Ù„Ùˆ Apigee Ø±Ø¬Ø¹ 400/404 | `CLIENT_ERROR` |
| `HttpServerErrorException` | Ù„Ùˆ OSB Ø£Ùˆ AI Ø±Ø¬Ø¹ 500 | `AI_SERVER_ERROR` |
| `ResourceAccessException` | Ù„Ùˆ Ø­ØµÙ„ Timeout | `AI_UNAVAILABLE` |
| `Exception` | Ø£ÙŠ Ø®Ø·Ø£ ØªØ§Ù†ÙŠ | `ERROR` |

**ÙÙŠ ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª:** Ø¨ÙŠØ±Ø¬Ø¹ response ÙÙŠÙ‡Ø§:
- `status`: Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·Ø£
- `suggestions`: Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø¶ÙŠØ© `[]`
- `message`: Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©

---

### **Ø§Ù„Ø®Ø·ÙˆØ© 4: Apigee Proxy #2 ÙŠØ³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Backend**

**Ø§Ù„Ù€ Proxy Ø§Ù„Ø¬Ø¯ÙŠØ¯:** `OSB_AISuggestionsProxy` â† **Ù„Ø§Ø²Ù… ÙŠÙ†Ø¹Ù…Ù„**
**Ø§Ù„Ù…Ø³Ø§Ø±:** `/v1/osb/ai/suggestions`

**Ø§Ù„Ù„ÙŠ Ø¨ÙŠØ­ØµÙ„:**
1. **PreFlow:**
   - Ø¨ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù€ `apikey` Ø§Ù„Ù„ÙŠ Backend Ø¨Ø¹ØªÙ‡.
   
2. **Routing:**
   - Ø¨ÙŠÙˆØ¬Ù‘Ù‡ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ù€ **OSB**.

---

### **Ø§Ù„Ø®Ø·ÙˆØ© 5: OSB ÙŠÙˆØµÙ‘Ù„ Ù„Ù„Ù€ AI**

**OSB** Ø¨ÙŠØ§Ø®Ø¯ Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Apigee ÙˆÙŠØ¨Ø¹ØªÙ‡ Ù„Ù„Ù€ **AI Service**.

**Ø§Ù„Ù€ AI Service:**
- Ø¨ÙŠØ³ØªÙ‚Ø¨Ù„ `regNo=501234567`
- Ø¨ÙŠØ­Ù„Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ML Models
- Ø¨ÙŠØ±Ø¬Ø¹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª:

```json
{
  "status": "SUCCESS",
  "suggestions": [
    {
      "establishmentId": 501999888,
      "establishmentName": "Ø´Ø±ÙƒØ© Ø§Ù„Ù†Ø¬Ø§Ø­ Ù„Ù„ØªØ¬Ø§Ø±Ø©",
      "matchScore": 0.92,
      "reason": "Similar industry",
      "industry": "Retail",
      "location": "Riyadh"
    },
    {
      "establishmentId": 501777666,
      "establishmentName": "Ù…Ø¤Ø³Ø³Ø© Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©",
      "matchScore": 0.85,
      "reason": "Same owner network",
      "industry": "Wholesale",
      "location": "Jeddah"
    }
  ]
}
```

---

### **Ø§Ù„Ø®Ø·ÙˆØ© 6: Ø§Ù„Ø±Ø¯ ÙŠØ±Ø¬Ø¹ Ø¹ÙƒØ³ Ø§Ù„Ù…Ø³Ø§Ø±**

```
AI â†’ OSB â†’ Apigee #2 â†’ Backend â†’ Apigee #1 â†’ UI
```

---

## ğŸ“¦ **4. DTOs (Data Transfer Objects)**

### **Ø£. SuggestionsResponse**
```java
public class SuggestionsResponse {
    private String status;              // Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
    private List<EstablishmentSuggestion> suggestions;  // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    private String message;             // Ø±Ø³Ø§Ù„Ø© Ø¥Ø¶Ø§ÙÙŠØ©
    private String requestId;           // Ù„Ù„Ù€ tracking
    private Long timestamp;             // ÙˆÙ‚Øª Ø§Ù„Ø±Ø¯
}
```

### **Ø¨. EstablishmentSuggestion**
```java
public class EstablishmentSuggestion {
    private Long establishmentId;       // Ø±Ù‚Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø©
    private String establishmentName;   // Ø§Ù„Ø§Ø³Ù…
    private Double matchScore;          // Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ·Ø§Ø¨Ù‚ (0-1)
    private String reason;              // Ø³Ø¨Ø¨ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­
    private String industry;            // Ø§Ù„Ù†Ø´Ø§Ø·
    private String location;            // Ø§Ù„Ù…ÙˆÙ‚Ø¹
}
```

---

## âš™ï¸ **5. Configuration (Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª)**

### **ÙÙŠ application-local.properties:**

```properties
# Apigee URL
api.base.url=http://amnapigeedev.gosi.ins:9640

# API Key
app.apikey=AbLvRAQpDbkKi9haiVOzydAGShiDhpGC

# OSB Proxy Path
osb.ai.apigee.path=/v1/osb/ai/suggestions

# Timeout
osb.ai.timeout=10000
```

**Ø´Ø±Ø­:**
- `api.base.url`: Ø¹Ù†ÙˆØ§Ù† Apigee
- `app.apikey`: Ø§Ù„Ù…ÙØªØ§Ø­ Ù„Ù„ØªØ­Ù‚Ù‚
- `osb.ai.apigee.path`: Ø§Ù„Ù…Ø³Ø§Ø± Ù„Ù„Ù€ Proxy Ø§Ù„ØªØ§Ù†ÙŠ
- `osb.ai.timeout`: Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø£Ù‚ØµÙ‰ (10 Ø«ÙˆØ§Ù†ÙŠ)

---

## ğŸ§ª **6. Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±**

### **Request:**
```bash
curl -X GET \
  'https://ameenfea12.apigee.net/v1/owner-sphere/b2b/501234567/suggestions' \
  -H 'apikey: AbLvRAQpDbkKi9haiVOzydAGShiDhpGC'
```

### **Response (Success):**
```json
{
  "status": "SUCCESS",
  "suggestions": [
    {
      "establishmentId": 501999888,
      "establishmentName": "Ø´Ø±ÙƒØ© Ø§Ù„Ù†Ø¬Ø§Ø­ Ù„Ù„ØªØ¬Ø§Ø±Ø©",
      "matchScore": 0.92,
      "reason": "Similar industry",
      "industry": "Retail",
      "location": "Riyadh"
    }
  ],
  "message": null,
  "requestId": "abc-123-xyz",
  "timestamp": 1729612345000
}
```

### **Response (Error - AI Unavailable):**
```json
{
  "status": "AI_UNAVAILABLE",
  "suggestions": [],
  "message": "AI service is temporarily unavailable",
  "requestId": "def-456-uvw",
  "timestamp": 1729612350000
}
```

---

## ğŸ” **7. Ø§Ù„Ø£Ù…Ø§Ù† (Security)**

### **Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª:**
1. **API Key ÙÙŠ Apigee:**
   - ÙƒÙ„ request Ù„Ø§Ø²Ù… ÙÙŠÙ‡ `apikey`
   - Ù„Ùˆ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ â†’ 401

2. **AmeenSecurityCheck:**
   - ÙØ­Øµ Ø£Ù…Ù†ÙŠ Ø¥Ø¶Ø§ÙÙŠ Ø¯Ø§Ø®Ù„ÙŠ
   - Ø¨ÙŠØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…ØµØ¯Ø±

3. **OAuth 2.0 (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):**
   - Ù„Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø£Ù‚ÙˆÙ‰

---

## ğŸ“Š **8. Ø§Ù„Ø®Ù„Ø§ØµØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©**

### **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:**
| Ø§Ù„Ù…ÙƒÙˆÙ‘Ù† | Ø§Ù„ÙˆØ¸ÙŠÙØ© | Ø§Ù„ØªÙ‚Ù†ÙŠØ© |
|---------|---------|---------|
| UI | Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© | Angular |
| Apigee #1 | Ø£Ù…Ø§Ù† + ØªÙˆØ¬ÙŠÙ‡ | API Gateway |
| Backend | Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¹Ù…Ù„ | Spring Boot |
| Apigee #2 | ÙˆØ³ÙŠØ· Ù„Ù€ OSB | API Gateway |
| OSB | ØªØ­ÙˆÙŠÙ„ + ØªÙˆØ¬ÙŠÙ‡ | Oracle Service Bus |
| AI | Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ | ML Models |

### **Ø§Ù„Ù€ Flow:**
```
UI â†’ Apigee #1 â†’ Backend â†’ Apigee #2 â†’ OSB â†’ AI
                                              â†“
UI â† Apigee #1 â† Backend â† Apigee #2 â† OSB â† AI
```

### **Ø§Ù„Ù…Ù„ÙØ§Øª:**
1. `B2BSuggestionsController.java` - REST Controller
2. OsbAiProxy.java - HTTP Client
3. `SuggestionsResponse.java` - DTO
4. `EstablishmentSuggestion.java` - DTO
5. osp.properties - Configuration

---

**Ù‡Ù„ ÙÙŠÙ‡ Ø£ÙŠ Ø¬Ø²Ø¡ Ù…Ø­ØªØ§Ø¬ ØªÙˆØ¶ÙŠØ­ Ø£ÙƒØªØ±ØŸ** ğŸ¤”
